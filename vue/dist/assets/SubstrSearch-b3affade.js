import{d as ne,$ as x,aw as ie,bQ as oe,ax as re,al as ue,ai as de,bP as K,o,y as C,q as N,c as i,r as e,bU as ce,p as d,N as _,m as k,n as r,x as S,v as f,C as h,s as P,t as pe,L as ve,U as me,V as fe,bS as ge,Q as we,R as xe,X as ke}from"./index-7014c21f.js";import{L as he,R as Ie,f as ye,S as be}from"./fullScreenContextMenu-98230b57.js";/* empty css              */import{g as Ce,F as _e}from"./FileItem-3525329e.js";import{b as L,c as Se,f as $e,u as Me}from"./db-a31c442b.js";import{c as ze,u as De}from"./hook-d5d8b6fe.js";import"./functionalCallableComp-c44a8b16.js";const Ue="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",Be=["src"],Fe={class:"search-bar last"},Re={class:"form-name"},Ve={class:"hint"},Ee={key:1,class:"preview-switch"},Ae=ne({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(G){const $=G,c=x(!1),p=x(""),g=x($.searchScope??""),I=ze(t=>{const s={cursor:t,regexp:c.value?p.value:"",surstr:c.value?"":p.value,folder_paths:(g.value??"").split(/,|\n/).map(m=>m.trim()).filter(m=>m)};return $e(s)}),{queue:u,images:n,onContextMenuClickU:M,stackViewEl:O,previewIdx:v,previewing:z,onPreviewVisibleChange:Q,previewImgMove:D,canPreview:U,itemSize:B,gridItems:H,showGenInfo:w,imageGenInfo:F,q:W,multiSelectedIdxs:R,onFileItemClick:X,scroller:V,showMenuIdx:y,onFileDragStart:j,onFileDragEnd:J,cellWidth:Y,onScroll:E}=De(I),a=x();ie(async()=>{a.value=await L(),a.value.img_count&&a.value.expired&&await A(),$.searchScope&&await b()});const A=oe(()=>u.pushAction(async()=>(await Me(),a.value=await L(),a.value)).res),b=async()=>{await I.reset({refetch:!0}),await re(),E(),V.value.scrollToItem(0),n.value.length||ue.info(de("fuzzy-search-noResults"))};K("returnToIIB",async()=>{const t=await u.pushAction(Se).res;a.value.expired=t.expired}),K("searchIndexExpired",()=>a.value&&(a.value.expired=!0));const Z=()=>{c.value=!c.value};return(t,s)=>{const m=me,T=fe,ee=ge,se=we,ae=xe,te=be;return o(),C("div",{class:"container",ref_key:"stackViewEl",ref:O},[a.value?(o(),C("div",{key:0,class:"search-bar",onKeydown:s[2]||(s[2]=N(()=>{},["stop"]))},[i(m,{value:p.value,"onUpdate:value":s[0]||(s[0]=l=>p.value=l),placeholder:t.$t("fuzzy-search-placeholder")+" "+t.$t("regexSearchEnabledHint"),disabled:!e(u).isIdle,onKeydown:ce(b,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),d("div",{class:_(["regex-icon",{selected:c.value}]),onKeydown:s[1]||(s[1]=N(()=>{},["stop"])),onClick:Z,title:"Use Regular Expression"},[d("img",{src:e(Ue)},null,8,Be)],34),a.value.expired||!a.value.img_count?(o(),k(T,{key:0,onClick:e(A),loading:!e(u).isIdle,type:"primary"},{default:r(()=>[S(f(a.value.img_count===0?t.$t("generateIndexHint"):t.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(o(),k(T,{key:1,type:"primary",onClick:b,loading:!e(u).isIdle||e(I).loading,disabled:!p.value&&!g.value},{default:r(()=>[S(f(t.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):h("",!0),d("div",Fe,[d("div",Re,f(t.$t("searchScope")),1),i(ee,{"auto-size":{maxRows:8},value:g.value,"onUpdate:value":s[3]||(s[3]=l=>g.value=l),placeholder:t.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),i(te,{size:"large",spinning:!e(u).isIdle},{default:r(()=>[i(ae,{visible:e(w),"onUpdate:visible":s[5]||(s[5]=l=>P(w)?w.value=l:null),width:"70vw","mask-closable":"",onOk:s[6]||(s[6]=l=>w.value=!1)},{cancelText:r(()=>[]),default:r(()=>[i(se,{active:"",loading:!e(W).isIdle},{default:r(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[4]||(s[4]=l=>e(pe)(e(F)))},[d("div",Ve,f(t.$t("doubleClickToCopy")),1),S(" "+f(e(F)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),e(n)?(o(),k(e(Ce),{key:0,ref_key:"scroller",ref:V,class:"file-list",items:e(n),"item-size":e(B).first,"key-field":"fullpath","item-secondary-size":e(B).second,gridItems:e(H),onScroll:e(E)},{default:r(({item:l,index:q})=>[i(_e,{idx:q,file:l,"show-menu-idx":e(y),"onUpdate:showMenuIdx":s[7]||(s[7]=le=>P(y)?y.value=le:null),onFileItemClick:e(X),"full-screen-preview-image-url":e(n)[e(v)]?e(ve)(e(n)[e(v)]):"","cell-width":e(Y),selected:e(R).includes(q),onContextMenuClick:e(M),onDragstart:e(j),onDragend:e(J),"is-selected-mutil-files":e(R).length>1,onPreviewVisibleChange:e(Q)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):h("",!0),e(z)?(o(),C("div",Ee,[i(e(he),{onClick:s[8]||(s[8]=l=>e(D)("prev")),class:_({disable:!e(U)("prev")})},null,8,["class"]),i(e(Ie),{onClick:s[9]||(s[9]=l=>e(D)("next")),class:_({disable:!e(U)("next")})},null,8,["class"])])):h("",!0)]),_:1},8,["spinning"]),e(z)&&e(n)&&e(n)[e(v)]?(o(),k(ye,{key:1,file:e(n)[e(v)],idx:e(v),onContextMenuClick:e(M)},null,8,["file","idx","onContextMenuClick"])):h("",!0)],512)}}});const Oe=ke(Ae,[["__scopeId","data-v-7afef8c2"]]);export{Oe as default};
